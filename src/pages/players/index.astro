---
Astro.response.headers.set("Cache-Control", "public, max-age=60, s-maxage=300");

import { supabase } from "@/lib/supabase";
import Alert from "@/components/shared/Alert.astro";
import Main from "@/layouts/Main.astro";
import PlayerCard from "@/components/players/PlayerCard.astro";
import Title from "@/components/shared/Title.astro";

// 1. Consultar la vista histórica
const { data: players, error } = await supabase
  .from("view_player_stats_all_time")
  .select("*")
  .eq("is_guest", false) // Solo jugadores oficiales
  .order("nickname", { ascending: true });

const hasError = !!error;
const hasPlayers = !hasError && players && players.length > 0;
---

<Main title="Plantel | SGSC">
  <Title
    title="Plantel"
    subtitle="¡Haz click en cualquier jugador para conocer todas sus estadísticas!"
  />

  {/* Error de conexión/consulta */}
  {
    hasError && (
      <Alert
        type="error"
        message="No se pudo conectar con el servidor. Por favor, intenta más tarde."
      />
    )
  }

  {/* Sin datos (pero sin error) */}
  {
    !hasError && !hasPlayers && (
      <Alert
        type="warning"
        message="No hay jugadores registrados en el sistema."
      />
    )
  }

  {
    hasPlayers && (
      <div class="grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3">
        {players.map((player) => (
          <PlayerCard player={player} />
        ))}
      </div>
    )
  }
</Main>
