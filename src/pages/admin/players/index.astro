---
import Main from "@/layouts/Main.astro";
import Title from "@/components/shared/Title.astro";
import { createAstroSupabase } from "@/lib/supabase";
import { Icon } from "astro-icon/components";
import TableWrapper from "@/components/shared/TableWrapper.astro";
import PageHeader from "@/components/shared/PageHeader.astro";
import Avatar from "@/components/Avatar.astro";

const supabase = createAstroSupabase(Astro);

const { data: players } = await supabase
  .from("players")
  .select("*")
  .order("nickname", { ascending: true });
---

<Main title="Gestión de Jugadores">
  <Title title="Plantel" subtitle="Panel de Administración" />
  <div class="w-full py-6 lg:py-8">
    <div
      class="mb-6 flex flex-col items-start justify-between gap-4 sm:flex-row sm:items-center lg:mb-8"
    >
      <a
        href="/admin/players/create"
        class="btn btn-primary btn-sm lg:btn-md gap-2 rounded-xl shadow-md"
      >
        <Icon name="material-symbols:person-add" size={18} />
        Nuevo Jugador
      </a>
    </div>

    <TableWrapper>
      <table class="table-xs sm:table-sm lg:table-md table w-full">
        <thead>
          <tr
            class="bg-base-200/50 text-base-content/60 text-xs font-bold uppercase lg:text-sm"
          >
            <th class="w-10 lg:w-14"></th>
            <th>Jugador</th>
            <th class="hidden text-center sm:table-cell">Pierna</th>
            <th class="text-center">Estado</th>
            <th class="text-right">Acciones</th>
          </tr>
        </thead>
        <tbody>
          {
            players?.map((player) => (
              <tr class="hover group">
                <td>
                  <Avatar
                    initial={player.nickname.charAt(0).toUpperCase()}
                    size="sm"
                  />
                </td>
                <td>
                  <div class="font-bold lg:text-base">{player.nickname}</div>
                  {(player.first_name || player.last_name) && (
                    <div class="text-base-content/60 text-xs lg:text-sm">
                      {player.first_name} {player.last_name}
                    </div>
                  )}
                </td>
                <td class="hidden text-center sm:table-cell">
                  {player.preferred_foot === "right" && (
                    <Icon
                      name="material-symbols:footprint"
                      class="inline text-blue-500"
                      size={20}
                      title="Diestro"
                    />
                  )}
                  {player.preferred_foot === "left" && (
                    <Icon
                      name="material-symbols:footprint"
                      class="inline scale-x-[-1] transform text-green-500"
                      size={20}
                      title="Zurdo"
                    />
                  )}
                  {player.preferred_foot === "both" && (
                    <span class="badge badge-xs badge-ghost lg:badge-sm">
                      Ambidiestro
                    </span>
                  )}
                </td>
                <td class="text-center">
                  {player.is_active ? (
                    <span class="badge badge-success badge-xs lg:badge-sm gap-1 text-white">
                      Activo
                    </span>
                  ) : (
                    <span class="badge badge-error badge-xs lg:badge-sm gap-1 text-white">
                      Inactivo
                    </span>
                  )}
                </td>
                <td class="text-right">
                  <a
                    href={`/admin/players/edit/${player.id}`}
                    class="btn btn-square btn-ghost btn-xs text-info lg:btn-sm"
                    title="Editar jugador"
                  >
                    <Icon
                      name="material-symbols:edit"
                      size={16}
                      class="lg:hidden"
                    />
                    <Icon
                      name="material-symbols:edit"
                      size={18}
                      class="hidden lg:block"
                    />
                  </a>
                </td>
              </tr>
            ))
          }
        </tbody>
        >
        <Icon name="material-symbols:edit-square-outline" size={18} />
      </table>
    </TableWrapper>
  </div>
  )) }
</Main>
