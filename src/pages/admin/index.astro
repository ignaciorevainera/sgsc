---
import Main from "@/layouts/Main.astro";
import { createAstroSupabase } from "@/lib/supabase";
import { Icon } from "astro-icon/components";

const supabase = createAstroSupabase(Astro);
const {
  data: { session },
} = await supabase.auth.getSession();

if (!session) return Astro.redirect("/signin");

// Opcional: Obtener conteos rápidos para mostrar en el dashboard
const { count: matchCount } = await supabase
  .from("matches")
  .select("*", { count: "exact", head: true });
const { count: playerCount } = await supabase
  .from("players")
  .select("*", { count: "exact", head: true })
  .eq("is_active", true);
---

<Main title="Panel de Administración">
  <div class="mx-auto max-w-5xl px-4 py-10">
    <div
      class="mb-10 flex flex-col items-center justify-between gap-4 md:flex-row"
    >
      <div>
        <h1 class="text-primary text-3xl font-black uppercase italic">
          Panel de Control
        </h1>
        <p class="text-sm font-bold tracking-wider uppercase opacity-60">
          Bienvenido, Admin
        </p>
      </div>

      <form action="/api/auth/signout" method="post">
        <button type="submit" class="btn btn-outline btn-error btn-sm gap-2">
          <Icon name="material-symbols:logout" />
          Cerrar Sesión
        </button>
      </form>
    </div>

    <div class="grid grid-cols-1 gap-6 md:grid-cols-2">
      <div class="space-y-4">
        <h2
          class="flex items-center gap-2 text-sm font-black uppercase opacity-40"
        >
          <Icon name="material-symbols:sports-soccer" /> Gestión de Partidos
        </h2>

        <div class="grid gap-4">
          <a
            href="/admin/matches/create"
            class="card bg-base-100 border-base-200 hover:border-primary/50 group border shadow-md transition-all hover:shadow-xl"
          >
            <div class="card-body flex flex-row items-center gap-4">
              <div
                class="bg-primary/10 text-primary group-hover:bg-primary rounded-full p-4 transition-colors group-hover:text-white"
              >
                <Icon name="material-symbols:add-circle-outline" size={32} />
              </div>
              <div>
                <h3 class="text-lg font-black">Nuevo Partido</h3>
                <p class="text-xs font-bold uppercase opacity-60">
                  Registrar resultado reciente
                </p>
              </div>
            </div>
          </a>

          <a
            href="/admin/matches"
            class="card bg-base-100 border-base-200 hover:border-secondary/50 group border shadow-md transition-all hover:shadow-xl"
          >
            <div class="card-body flex flex-row items-center gap-4">
              <div
                class="bg-secondary/10 text-secondary group-hover:bg-secondary rounded-full p-4 transition-colors group-hover:text-white"
              >
                <Icon name="material-symbols:edit-document-rounded" size={32} />
              </div>
              <div>
                <h3 class="text-lg font-black">Historial y Edición</h3>
                <p class="text-xs font-bold uppercase opacity-60">
                  Corregir datos
                </p>
              </div>
            </div>
          </a>
        </div>
      </div>

      <div class="space-y-4">
        <h2
          class="flex items-center gap-2 text-sm font-black uppercase opacity-40"
        >
          <Icon name="material-symbols:groups" /> Gestión de Plantel
        </h2>

        <div class="grid gap-4">
          <a
            href="/admin/players/create"
            class="card bg-base-100 border-base-200 hover:border-success/50 group border shadow-md transition-all hover:shadow-xl"
          >
            <div class="card-body flex flex-row items-center gap-4">
              <div
                class="bg-success/10 text-success group-hover:bg-success rounded-full p-4 transition-colors group-hover:text-white"
              >
                <Icon name="material-symbols:person-add" size={32} />
              </div>
              <div>
                <h3 class="text-lg font-black">Agregar Jugador</h3>
                <p class="text-xs font-bold uppercase opacity-60">
                  Alta de nuevo integrante
                </p>
              </div>
            </div>
          </a>

          <a
            href="/admin/players"
            class="card bg-base-100 border-base-200 hover:border-warning/50 group border shadow-md transition-all hover:shadow-xl"
          >
            <div class="card-body flex flex-row items-center gap-4">
              <div
                class="bg-warning/10 text-warning group-hover:bg-warning rounded-full p-4 transition-colors group-hover:text-white"
              >
                <Icon name="material-symbols:manage-accounts" size={32} />
              </div>
              <div>
                <h3 class="text-lg font-black">Editar Plantel</h3>
                <p class="text-xs font-bold uppercase opacity-60">
                  Bajas y modificaciones ({playerCount} activos)
                </p>
              </div>
            </div>
          </a>
        </div>
      </div>
    </div>
  </div>
</Main>
