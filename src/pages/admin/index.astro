---
import { createAstroSupabase } from "@/lib/supabase";
import ActionCard from "@/components/admin/ActionCard.astro";
import Main from "@/layouts/Main.astro";
import SectionTitle from "@/components/shared/SectionTitle.astro";
import StatCard from "@/components/admin/StatCard.astro";
import Title from "@/components/shared/Title.astro";

const supabase = createAstroSupabase(Astro);
const {
  data: { session },
} = await supabase.auth.getSession();

if (!session) return Astro.redirect("/signin");

// Obtener conteos rápidos para mostrar en el dashboard
const { count: matchCount } = await supabase
  .from("matches")
  .select("*", { count: "exact", head: true });

// Jugadores habituales (socios) activos
const { count: regularPlayerCount } = await supabase
  .from("players")
  .select("*", { count: "exact", head: true })
  .eq("is_active", true)
  .eq("is_guest", false);

// Jugadores invitados activos
const { count: guestPlayerCount } = await supabase
  .from("players")
  .select("*", { count: "exact", head: true })
  .eq("is_active", true)
  .eq("is_guest", true);
---

<Main title="Panel de Administración">
  <Title title="Panel de Control" subtitle="Panel de Administración" />
  <div>
    <div class="mb-8 grid grid-cols-1 gap-4 sm:grid-cols-3 lg:gap-6">
      <StatCard
        icon="material-symbols:sports-soccer"
        value={matchCount || 0}
        label="Partidos"
        color="primary"
      />
      <StatCard
        icon="material-symbols:groups"
        value={regularPlayerCount || 0}
        label="Jugadores Habituales"
        color="secondary"
      />
      <StatCard
        icon="material-symbols:person-add"
        value={guestPlayerCount || 0}
        label="Jugadores Invitados"
        color="accent"
      />
    </div>

    <div class="grid grid-cols-1 gap-6 lg:grid-cols-2 lg:gap-8">
      <div class="space-y-4 lg:space-y-6">
        <SectionTitle> Gestión de Partidos </SectionTitle>

        <div class="flex flex-col gap-4">
          <ActionCard
            href="/admin/matches/create"
            icon="material-symbols:add-circle"
            title="Nuevo Partido"
            description="Registrar resultado reciente"
            color="primary"
          />
          <ActionCard
            href="/admin/matches"
            icon="material-symbols:edit-document-rounded"
            title="Historial y Edición"
            description="Corregir datos"
            color="secondary"
          />
        </div>
      </div>

      <div class="space-y-4 lg:space-y-6">
        <SectionTitle> Gestión de Plantel </SectionTitle>

        <div class="flex flex-col gap-4">
          <ActionCard
            href="/admin/players/create"
            icon="material-symbols:person-add"
            title="Nuevo Jugador"
            description="Agregar al plantel"
            color="accent"
          />
          <ActionCard
            href="/admin/players"
            icon="material-symbols:list-alt"
            title="Gestionar Jugadores"
            description="Editar información"
            color="info"
          />
        </div>
      </div>
    </div>
  </div>
</Main>
