---
import TableWrapper from "@/components/shared/TableWrapper.astro";

const { players, showDetails } = Astro.props;

// Helper para colores de racha
const getFormColor = (result: any) => {
  switch (result) {
    case "W":
      return "bg-success text-success-content";
    case "D":
      return "bg-warning text-warning-content";
    case "L":
      return "bg-error text-error-content";
    default:
      return "bg-base-300";
  }
};

// Clase condicional:
// Si showDetails es true, NO ponemos 'hidden'.
// Si es false, ponemos 'hidden sm:table-cell' (oculto en movil, visible en sm+)
const responsiveClass = showDetails ? "" : "hidden sm:table-cell";
---

<TableWrapper class="w-full">
  <table class="table-zebra table-xs sm:table-sm lg:table-md table min-w-max">
    <thead
      class="bg-base-200 text-base-content sticky top-0 z-10 text-center text-xs font-bold uppercase sm:text-sm"
    >
      <tr>
        <th>#</th>
        <th class="text-left">Jugador</th>

        <th
          class="bg-primary/10 text-primary text-sm font-black sm:text-base"
          title="Puntos Totales">PTS</th
        >

        <th title="Partidos Jugados">PJ</th>
        <th class={`text-secondary ${responsiveClass}`} title="% Asistencia"
          >%Asist</th
        >

        <th class="text-success" title="Ganados">G</th>
        <th class={`text-success ${responsiveClass}`} title="% Victorias"
          >%Vic</th
        >

        <th class="text-warning" title="Empatados">E</th>
        <th class={`text-warning ${responsiveClass}`} title="% Empates">%Emp</th
        >

        <th class="text-error" title="Perdidos">P</th>
        <th class={`text-error ${responsiveClass}`} title="% Derrotas">%Der</th>

        <th class={`${responsiveClass}`}>Forma</th>
      </tr>
    </thead>

    <tbody>
      {
        players.map(
          (
            player: {
              player_id: string;
              nickname: unknown;
              matches: unknown;
              attendance_percentage: unknown;
              wins: unknown;
              win_pct: unknown;
              draws: unknown;
              draw_pct: unknown;
              losses: unknown;
              loss_pct: unknown;
              form_array: any[];
              points: unknown;
            },
            index: number
          ) => (
            <tr
              class="hover group cursor-pointer text-center text-xs transition-colors sm:text-sm"
              onclick={`window.location.href='/players/${player.player_id}'`}
            >
              <td class="font-bold">
                {index === 0 && <span class="text-base lg:text-lg">ðŸ¥‡</span>}
                {index === 1 && <span class="text-base lg:text-lg">ðŸ¥ˆ</span>}
                {index === 2 && <span class="text-base lg:text-lg">ðŸ¥‰</span>}
                {index > 2 && (
                  <span class="text-base-content/60">{index + 1}</span>
                )}
              </td>

              <td class="text-left">
                <span class="group-hover:text-primary font-medium transition-colors">
                  {player.nickname}
                </span>
              </td>

              <td class="bg-primary/5 text-primary text-sm font-black sm:text-base lg:text-lg">
                {player.points}
              </td>

              <td class="font-semibold">{player.matches}</td>
              <td class={`text-secondary font-medium ${responsiveClass}`}>
                {player.attendance_percentage}%
              </td>

              <td class="font-medium">{player.wins}</td>
              <td class={`text-success ${responsiveClass}`}>
                {player.win_pct}%
              </td>

              <td class="text-base-content/60 font-medium">{player.draws}</td>
              <td class={`text-warning ${responsiveClass}`}>
                {player.draw_pct}%
              </td>

              <td class="text-base-content/60 font-medium">{player.losses}</td>
              <td class={`text-error ${responsiveClass}`}>
                {player.loss_pct}%
              </td>

              <td class={`${responsiveClass}`}>
                <div class="flex justify-center gap-0.5">
                  {player.form_array &&
                    player.form_array.map((res: any) => (
                      <div
                        class={`h-2 w-2 rounded-full lg:h-2.5 lg:w-2.5 ${getFormColor(res)}`}
                      />
                    ))}
                </div>
              </td>
            </tr>
          )
        )
      }
    </tbody>
  </table>
</TableWrapper>
