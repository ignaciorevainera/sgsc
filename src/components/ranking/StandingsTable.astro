---
import TableWrapper from "@/components/shared/TableWrapper.astro";

const { players, showDetails } = Astro.props;

// Helper para colores de racha
const getFormColor = (result: any) => {
  switch (result) {
    case "W":
      return "bg-success text-success-content";
    case "D":
      return "bg-warning text-warning-content";
    case "L":
      return "bg-error text-error-content";
    default:
      return "bg-base-300";
  }
};

// Clase condicional para columnas responsive
const responsiveClass = showDetails ? "" : "hidden sm:table-cell";

// Colores de fondo para el podio
const getPodiumClass = (index: number) => {
  switch (index) {
    case 0:
      return "bg-amber-500/10";
    case 1:
      return "bg-slate-400/10";
    case 2:
      return "bg-amber-700/10";
    default:
      return "";
  }
};
---

<TableWrapper class="w-full">
  <table
    class="table-zebra table-xs sm:table-sm lg:table-md table min-w-max"
    aria-label="Tabla de clasificaciÃ³n de jugadores"
  >
    <caption class="sr-only"
      >ClasificaciÃ³n de jugadores con puntos, partidos jugados, victorias,
      empates y derrotas</caption
    >
    <thead
      class="bg-base-200 text-base-content sticky top-0 z-10 text-center text-xs font-bold uppercase sm:text-sm"
    >
      <tr>
        <th scope="col" abbr="PosiciÃ³n">#</th>
        <th scope="col" class="text-left">Jugador</th>

        <th
          scope="col"
          class="bg-primary/10 text-primary text-sm font-black sm:text-base"
          abbr="Puntos">PTS</th
        >

        <th scope="col" abbr="Partidos Jugados">PJ</th>
        <th
          scope="col"
          class={`text-secondary ${responsiveClass}`}
          abbr="Porcentaje de Asistencia">%Asist</th
        >

        <th scope="col" class="text-success" abbr="Ganados">G</th>
        <th
          scope="col"
          class={`text-success ${responsiveClass}`}
          abbr="Porcentaje de Victorias">%Vic</th
        >

        <th scope="col" class="text-warning" abbr="Empatados">E</th>
        <th
          scope="col"
          class={`text-warning ${responsiveClass}`}
          abbr="Porcentaje de Empates">%Emp</th
        >

        <th scope="col" class="text-error" abbr="Perdidos">P</th>
        <th
          scope="col"
          class={`text-error ${responsiveClass}`}
          abbr="Porcentaje de Derrotas">%Der</th
        >

        <th scope="col" class={`${responsiveClass}`}>Forma</th>
      </tr>
    </thead>

    <tbody>
      {
        players.map(
          (
            player: {
              player_id: string;
              nickname: unknown;
              matches: unknown;
              attendance_percentage: unknown;
              wins: unknown;
              win_pct: unknown;
              draws: unknown;
              draw_pct: unknown;
              losses: unknown;
              loss_pct: unknown;
              form_array: any[];
              points: unknown;
            },
            index: number,
          ) => (
            <tr
              class={`hover text-center text-xs transition-colors sm:text-sm ${getPodiumClass(index)}`}
            >
              <td class="font-bold">
                {index === 0 && <span class="text-base lg:text-lg">ðŸ¥‡</span>}
                {index === 1 && <span class="text-base lg:text-lg">ðŸ¥ˆ</span>}
                {index === 2 && <span class="text-base lg:text-lg">ðŸ¥‰</span>}
                {index > 2 && (
                  <span class="text-base-content/60">{index + 1}</span>
                )}
              </td>

              <td class="text-left">
                <a
                  href={`/players/${player.player_id}`}
                  class="hover:text-primary font-medium transition-colors hover:underline"
                >
                  {player.nickname}
                </a>
              </td>

              <td class="bg-primary/5 text-primary text-sm font-black sm:text-base lg:text-lg">
                {player.points}
              </td>

              <td class="font-semibold">{player.matches}</td>
              <td class={`text-secondary font-medium ${responsiveClass}`}>
                {player.attendance_percentage}%
              </td>

              <td class="font-medium">{player.wins}</td>
              <td class={`text-success ${responsiveClass}`}>
                {player.win_pct}%
              </td>

              <td class="text-base-content/60 font-medium">{player.draws}</td>
              <td class={`text-warning ${responsiveClass}`}>
                {player.draw_pct}%
              </td>

              <td class="text-base-content/60 font-medium">{player.losses}</td>
              <td class={`text-error ${responsiveClass}`}>
                {player.loss_pct}%
              </td>

              <td class={`${responsiveClass}`}>
                <div class="flex justify-center gap-0.5">
                  {player.form_array &&
                    player.form_array.map((res: any) => (
                      <div
                        class={`h-2 w-2 rounded-full lg:h-2.5 lg:w-2.5 ${getFormColor(res)}`}
                      />
                    ))}
                </div>
              </td>
            </tr>
          ),
        )
      }
    </tbody>
  </table>
</TableWrapper>
