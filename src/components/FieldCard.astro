---
import { Icon } from "astro-icon/components";
import ResultStats from "./ResultStats.astro"; // ✅ Usamos tu componente

interface Props {
  field: {
    id: string;
    name: string;
    city: string;
    stats: {
      totalMatches: number;
      lightWins: number;
      darkWins: number;
      draws: number;
      lastMatchDate: string | null;
    };
  };
}

const { field } = Astro.props;
const { stats } = field;

// Helper de fecha
const formatDate = (dateString: string | null) => {
  if (!dateString) return "Sin actividad";
  return new Date(dateString + "T00:00:00").toLocaleDateString("es-AR", {
    month: "short",
    year: "numeric",
  });
};
---

<div
  class="card bg-base-100 border-base-200 group relative h-full overflow-hidden rounded-xl border shadow-md transition-all hover:-translate-y-1 hover:shadow-lg"
>
  <Icon
    name="material-symbols:stadium-rounded"
    class="text-base-content/5 pointer-events-none absolute -right-6 -bottom-6 h-32 w-32 -rotate-12"
  />

  <div class="card-body">
    {/* ENCABEZADO: Título y Ciudad */}
    <div class="mb-4 flex items-start justify-between">
      <div class="flex gap-3">
        <div class="mt-1">
          <Icon
            name="material-symbols:location-on"
            class="text-error"
            size={24}
          />
        </div>
        <div>
          <h2 class="card-title text-xl leading-tight font-bold">
            {field.name}
          </h2>
          <p class="text-base-content/60 text-sm font-medium">{field.city}</p>
        </div>
      </div>

      {/* Badge de PJ */}
      <div class="badge badge-neutral rounded-xl shrink-0 font-bold">
        {stats.totalMatches} PJ
      </div>
    </div>

    <div class="divider my-1"></div>

    {/* ESTADÍSTICAS (Tu componente modular) */}
    <div class="relative z-10 mt-2">
      <ResultStats
        lightWins={stats.lightWins}
        darkWins={stats.darkWins}
        draws={stats.draws}
      />
    </div>

    {/* FOOTER: Última Actividad */}
    <div
      class="border-base-200 text-base-content/60 relative z-10 mt-auto flex items-center justify-between border-t pt-4 text-xs"
    >
      <span class="flex items-center gap-1">
        <Icon name="material-symbols:calendar-today" size={12} /> Último juego:
      </span>
      <span class="font-bold">
        {formatDate(stats.lastMatchDate)}
      </span>
    </div>
  </div>
</div>
